#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>
#include <time.h>
#include "../apis/custom_inst_api.h"
#include <riscv_vector.h>
#include "parameters.h"
#include "reed_muller.h"

bool test_reed_muller_encode_custom(){
    uint64_t v_ref[VEC_N1N2_SIZE_64] = {
        12273810550958675370ull,12273810550958675370ull,12273810550958675370ull,12273810550958675370ull,12273810550958675370ull,12273810550958675370ull,18446744069414584320ull,4294967295ull,
        18446744069414584320ull,4294967295ull,18446744069414584320ull,4294967295ull,72056498804490495ull,72056498804490495ull,72056498804490495ull,72056498804490495ull,
        72056498804490495ull,72056498804490495ull,18374687579166474495ull,72056494543077120ull,18374687579166474495ull,72056494543077120ull,18374687579166474495ull,72056494543077120ull,
        14068186145234338620ull,4378557928475212995ull,14068186145234338620ull,4378557928475212995ull,14068186145234338620ull,4378557928475212995ull,11053635145317115545ull,7393108928392436070ull,
        11053635145317115545ull,7393108928392436070ull,11053635145317115545ull,7393108928392436070ull,11053691000514504345ull,11053691000514504345ull,11053691000514504345ull,11053691000514504345ull,
        11053691000514504345ull,11053691000514504345ull,3732415143318664140ull,14714328930390887475ull,3732415143318664140ull,14714328930390887475ull,3732415143318664140ull,14714328930390887475ull,
        11068046444225730969ull,11068046444225730969ull,11068046444225730969ull,11068046444225730969ull,11068046444225730969ull,11068046444225730969ull,14757226373981654220ull,3689517699727897395ull,
        14757226373981654220ull,3689517699727897395ull,14757226373981654220ull,3689517699727897395ull,14757395258967641292ull,14757395258967641292ull,14757395258967641292ull,14757395258967641292ull,
        14757395258967641292ull,14757395258967641292ull,6149008516228732245ull,6149008516228732245ull,6149008516228732245ull,6149008516228732245ull,6149008516228732245ull,6149008516228732245ull,
        14106184687260844995ull,4340559386448706620ull,14106184687260844995ull,4340559386448706620ull,14106184687260844995ull,4340559386448706620ull,11936128518282651045ull,6510615555426900570ull,
        11936128518282651045ull,6510615555426900570ull,11936128518282651045ull,6510615555426900570ull,11053691001366813030ull,11053691001366813030ull,11053691001366813030ull,11053691001366813030ull,
        11053691001366813030ull,11053691001366813030ull,11068046444225730969ull,11068046444225730969ull,11068046444225730969ull,11068046444225730969ull,11068046444225730969ull,11068046444225730969ull,
        1148681856222171120ull,1148681856222171120ull,1148681856222171120ull,1148681856222171120ull,1148681856222171120ull,1148681856222171120ull,14068186147490380995ull,14068186147490380995ull,
        14068186147490380995ull,14068186147490380995ull,14068186147490380995ull,14068186147490380995ull,71777214294589695ull,71777214294589695ull,71777214294589695ull,71777214294589695ull,
        71777214294589695ull,71777214294589695ull,10838359358483043945ull,10838359358483043945ull,10838359358483043945ull,10838359358483043945ull,10838359358483043945ull,10838359358483043945ull,
        14757226373981654220ull,3689517699727897395ull,14757226373981654220ull,3689517699727897395ull,14757226373981654220ull,3689517699727897395ull,7608384715978544745ull,7608384715978544745ull,
        7608384715978544745ull,7608384715978544745ull,7608384715978544745ull,7608384715978544745ull,12273810549538204245ull,6172933524171347370ull,12273810549538204245ull,6172933524171347370ull,
        12273810549538204245ull,6172933524171347370ull,17298062221247451120ull,1148681852462100495ull,17298062221247451120ull,1148681852462100495ull,17298062221247451120ull,1148681852462100495ull,
        14714328927833961420ull,3732415145875590195ull,14714328927833961420ull,3732415145875590195ull,14714328927833961420ull,3732415145875590195ull,1085350952844660495ull,17361393120864891120ull,
        1085350952844660495ull,17361393120864891120ull,1085350952844660495ull,17361393120864891120ull,12297829382473034410ull,6148914691236517205ull,12297829382473034410ull,6148914691236517205ull,
        12297829382473034410ull,6148914691236517205ull,3732415145875590195ull,14714328927833961420ull,3732415145875590195ull,14714328927833961420ull,3732415145875590195ull,14714328927833961420ull,
        14714328930390887475ull,14714328930390887475ull,14714328930390887475ull,14714328930390887475ull,14714328930390887475ull,14714328930390887475ull,12297735557480819370ull,12297735557480819370ull,
        12297735557480819370ull,12297735557480819370ull,12297735557480819370ull,12297735557480819370ull,7608434000728254870ull,10838310072981296745ull,7608434000728254870ull,10838310072981296745ull,
        7608434000728254870ull,10838310072981296745ull,14714328930390887475ull,3732415143318664140ull,14714328930390887475ull,3732415143318664140ull,14714328930390887475ull,3732415143318664140ull,
        17298062221247451120ull,1148681852462100495ull,17298062221247451120ull,1148681852462100495ull,17298062221247451120ull,1148681852462100495ull,7595767820052752745ull,7595767820052752745ull,
        7595767820052752745ull,7595767820052752745ull,7595767820052752745ull,7595767820052752745ull,72056494543077120ull,72056494543077120ull,72056494543077120ull,72056494543077120ull,
        72056494543077120ull,72056494543077120ull,6172933524171347370ull,6172933524171347370ull,6172933524171347370ull,6172933524171347370ull,6172933524171347370ull,6172933524171347370ull,
        17298308644996116495ull,1148435428713435120ull,17298308644996116495ull,1148435428713435120ull,17298308644996116495ull,1148435428713435120ull,6172933524171347370ull,6172933524171347370ull,
        6172933524171347370ull,6172933524171347370ull,6172933524171347370ull,6172933524171347370ull,6149008516228732245ull,6149008516228732245ull,6149008516228732245ull,6149008516228732245ull,
        6149008516228732245ull,6149008516228732245ull,7595767820052752745ull,10850976253656798870ull,7595767820052752745ull,10850976253656798870ull,7595767820052752745ull,10850976253656798870ull,
        7595767819294840470ull,7595767819294840470ull,7595767819294840470ull,7595767819294840470ull,7595767819294840470ull,7595767819294840470ull,281470681808895ull,18446462603027742720ull,
        281470681808895ull,18446462603027742720ull,281470681808895ull,18446462603027742720ull,281470681808895ull,281470681808895ull,281470681808895ull,281470681808895ull,
        281470681808895ull,281470681808895ull,6149008514797120170ull,6149008514797120170ull,6149008514797120170ull,6149008514797120170ull,6149008514797120170ull,6149008514797120170ull,
        6531726502061057370ull,6531726502061057370ull,6531726502061057370ull,6531726502061057370ull,6531726502061057370ull,6531726502061057370ull,17361393120864891120ull,1085350952844660495ull,
        17361393120864891120ull,1085350952844660495ull,17361393120864891120ull,1085350952844660495ull
    };
    uint64_t v_res[VEC_N1N2_SIZE_64] = {0};
    uint64_t tmp[VEC_N1_SIZE_64] = {
        5380635517672513561ull,9442858707034731139ull,6699578827259551292ull,14591435790409135210ull,17848110347540019036ull,127736917053463ull
    };

    uint64_t start, end;

    start=read_cycle();
    reed_muller_encode(v_res, tmp);
    end=read_cycle();
    printf("Reference finished with %lu cycles\n",end-start);

    start=read_cycle();
    reed_muller_encode(v_res, tmp);
    end=read_cycle();
    printf("Custom finished with %lu cycles\n",end-start);

    //CHECK
    bool flag=true;
    for(int i=0;i<VEC_N1N2_SIZE_64;i++){
        if(v_ref[i]!=v_res[i]){
            flag=false;
            break;
        }
    }

    printf("test_reed_muller_encode_custom return with flag %d\n",flag);

    return flag;
}

bool test_reed_muller_decode_custom(){
    uint64_t em[VEC_N1N2_SIZE_64]={
        15723569987237270884ull,16601945700204894110ull,10832977478236029205ull,15737078458200876487ull,10976848623257016232ull,9536739888529166378ull,13629574972754123672ull,8935147489161966814ull,
        14978344468896311588ull,7819964546102292415ull,17129144840917879808ull,9403716165739660887ull,3240303926618032567ull,2801093981323662325ull,8645765408310231725ull,11023598433899534902ull,
        9546856880964280448ull,10443670742113510522ull,8502937276943446390ull,10014591690634516745ull,6611450279057483899ull,16932395981364733450ull,9045278632081123524ull,16710531319877032716ull,
        14582110655963973245ull,3062870046063580643ull,15827363586476327024ull,13682429747357721827ull,251564139393143197ull,4380823479175098307ull,6368492485257472184ull,7444876140186511123ull,
        5580072199175660944ull,265725990691002052ull,7917336506636182231ull,5014714506967196676ull,10121550235080159573ull,8665656532413876635ull,18258289357065660089ull,1816532164831512480ull,
        13508146915408694933ull,11813808461994083480ull,2824979953071044829ull,12410518933788142618ull,14025533010782764784ull,16192490251209434651ull,4015108520168788469ull,16858062075412374840ull,
        11092043243384322989ull,13049615714247047577ull,10491376336425527443ull,13084513394736728512ull,13835543652284847455ull,9892306787239468474ull,11307116591879793036ull,8319076537171479899ull,
        9555573490145007314ull,2582596535973606753ull,13736811224764706268ull,12940140242061000715ull,5241255146309786632ull,10285070344868650503ull,17682475621302490820ull,14727861525872930359ull,
        11992255299739827273ull,646988523215975749ull,9732644914713875667ull,15523814912479403892ull,8781907236108132305ull,17371416267718337857ull,307689714570992900ull,9102780826409917149ull,
        14034887645492261109ull,17909778707896777775ull,17543555443890676218ull,4136542519813731900ull,6373216295573191376ull,8749591940712586361ull,3649673904172542210ull,6529028284101517143ull,
        9549785934547689495ull,6703837064983730267ull,12217182135066734275ull,5520773761457094232ull,12325984836558166116ull,13789960985435871597ull,13330858848264828682ull,1537058586535233979ull,
        13748563520631756902ull,13305736034984933719ull,4976925330424496538ull,14568081023787682076ull,7311962986860378238ull,18101473085568818584ull,10978000410459609624ull,1838551623594252541ull,
        14847463137898668504ull,2432379942918270614ull,7767253912881213125ull,6680519159347318355ull,5652257461068011511ull,1833376879672504278ull,14275113674639174866ull,264932565338634626ull,
        14478014684307037677ull,14658137392672730564ull,16949075865650542724ull,2754820243808627930ull,2377493713739170259ull,4837761690726721503ull,25473844136055356ull,11059522885788753279ull,
        4773545013290060236ull,2433396250311086818ull,13418922001885107939ull,15343080556451114085ull,10949691525380215023ull,16638855005545468137ull,11361902796365926431ull,13484365770269400672ull,
        5601689822486006997ull,3184498886391112551ull,5045361113952250054ull,7763012635674941284ull,13656149067278905287ull,1527646813552448250ull,3207109627039024873ull,4924664943290717289ull,
        8696585588152317578ull,16362352686112187721ull,757657540022822011ull,8726697365521143113ull,11694002631561036977ull,468721596321767266ull,13699214830181288452ull,80617584052487035ull,
        12274546760141621946ull,6669446735037747210ull,7041725328672819141ull,13174015367942284107ull,10401466552570808188ull,17579926038890930309ull,15734809613529200112ull,5177162730063321652ull,
        7867465988214160362ull,2259763405029315625ull,2367992165944988120ull,3803521809062018106ull,10240983337152428817ull,13243079517452094901ull,1121163300858668423ull,17739728604037832951ull,
        1120739063130835743ull,3464962819968676055ull,10923006253025310787ull,8368821947181514936ull,12703988844560338086ull,2242587972666986068ull,16950056179194284870ull,6367954502164460003ull,
        12367775987075301166ull,8568821767355097401ull,2656641680982542835ull,6932100406993187016ull,4165219386866259827ull,17672631205858129692ull,4458607393619859902ull,9549125249250439816ull,
        14385621125555207171ull,13233128472458954299ull,13544519515767934387ull,14426085632719961659ull,7501777036404582330ull,17546004408315798755ull,12540946578275676398ull,18054727858670447272ull,
        16761113425037263562ull,4480636641397320089ull,12514963750195292895ull,3074570262693670842ull,12359854735759984647ull,15086321655402157083ull,3357413913664499986ull,11112905903928938617ull,
        3005788768200117124ull,14170556480596775432ull,1536829672205764659ull,15803011503830515580ull,8075902907024598129ull,6560749689497809515ull,3984514017107270695ull,5901595514210367707ull,
        8166746554676094890ull,4709692701320726603ull,13962576203699695596ull,5699843182997289351ull,3588034526068821884ull,16081498708581331482ull,11847113625934130235ull,16735676239689251113ull,
        8101324288413298748ull,5397615588258113600ull,14517924140246033701ull,16847297114884557481ull,14192757229890728836ull,15249997984297803409ull,15058470925674068245ull,2320193700818157363ull,
        1581165639541570564ull,8272966973121154828ull,3569628780359992666ull,8548105274850627373ull,16081096933430803338ull,6963896917741033243ull,6905353111298866400ull,1687029383141851303ull,
        13414104080470497287ull,18327986828620623832ull,5262070304325744084ull,5148546027772447202ull,14992474706899827779ull,14600793112747601780ull,4722885021793140028ull,15543226546552709067ull,
        9077992787358696114ull,5384313331902402912ull,4624579109740484075ull,11330157515557654954ull,5532677359681734764ull,4905988424708343638ull,6300580971202366837ull,3824869911096333265ull,
        6131855585464905329ull,1680891746778902864ull,891017381072886059ull,1443799946669557380ull,4990914282405788002ull,9283866567742688774ull,6591377332266510760ull,15351624755579823098ull,
        7737650087390447814ull,4119637824996650374ull,17436187329992627840ull,5583817604602700182ull,12068669328451014499ull,6983277934897861766ull,1775257361481824182ull,11886199283766739585ull,
        10968679390560763817ull,14375156089535148578ull,5494598251766859095ull,12010401090676688078ull,1259061758842678263ull,2091488527544872199ull,10858627198196276221ull,3602984478851727334ull,
        4756521224014716510ull,12873744520843679979ull,1951719515345407136ull,6585776938111314653ull,5778587360612056038ull,15948854496085836462ull,8745122953309292706ull,8495064533482881954ull,
        4338393192330399843ull,5341550140782790599ull,10881887696454396888ull,15913148417536341530ull,13911014607229690904ull,5401909378886304850ull,17811955702734763440ull,4010979568032729583ull,
        17456382285620048866ull,11222876608680509199ull,17365039127165115367ull,10054202419391244167ull
    };
    uint64_t tmp_ref[VEC_N1_SIZE_64] = {
        5380635517672513561ull,9442858707034731139ull,6699578827259551292ull,14591435790409135210ull,17848110347540019036ull,127736917053463ull
    };
    uint64_t tmp_res[VEC_N1_SIZE_64] = {0};

    uint64_t start, end;

    start=read_cycle();
    reed_muller_decode(tmp_ref, em);
    end=read_cycle();
    printf("Reference finished with %lu cycles\n",end-start);

    start=read_cycle();
    reed_muller_decode_custom(tmp_res, em);
    end=read_cycle();
    printf("Custom finished with %lu cycles\n",end-start);

    //CHECK
    bool flag=true;
    for(int i=0;i<VEC_N1_SIZE_64;i++){
        if(tmp_ref[i]!=tmp_res[i]){
            flag=false;
            break;
        }
    }

    printf("test_reed_muller_decode_custom return with flag %d\n",flag);

    return flag;
}

int main(){
    // test_reed_muller_encode_custom();
    test_reed_muller_decode_custom();

    return 0;
}